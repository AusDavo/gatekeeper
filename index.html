<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Verify Bitcoin multisig wallet collaborators by validating cryptographic signatures" />
    <meta name="theme-color" content="#0d1117" />
    <title>Gatekeeper - Bitcoin Signature Validation</title>
    <link rel="stylesheet" href="style.css" />
    <script
      src="https://kit.fontawesome.com/2d818d2cc6.js"
      crossorigin="anonymous"
    ></script>
  </head>

  <body>
    <header id="heading">
      <h1 id="pageTitle">Gatekeeper</h1>
      <p id="pageSubtitle">Challenge your keymasters</p>
    </header>

    <main>
      <section id="multisigSection">
        <div id="uploadContainer">
          <label for="fileInput" id="uploadButton">
            <i class="fa-solid fa-file-import"></i>
            Load a multisig wallet descriptor
          </label>
          <input type="file" id="fileInput" accept=".txt, .bsms" />
        </div>
        <textarea
          id="multisigConfigInput"
          rows="5"
          placeholder="Or paste your wallet descriptor here..."
        ></textarea>
        <button id="extractXpubsButton">
          <i class="fa-solid fa-key"></i>
          Extract xpubs
        </button>
      </section>

      <section id="xpubRadioContainer"></section>

      <section id="elementsBelowXpub">
        <div id="derivationControls">
          <div id="addressTypeContainer">
            <label for="addressTypeSelect">Address Type</label>
            <select id="addressTypeSelect">
              <option value="legacy">Legacy (P2PKH) - 1...</option>
              <option value="segwit-wrapped">Wrapped SegWit (P2SH-P2WPKH) - 3...</option>
              <option value="segwit">Native SegWit (P2WPKH) - bc1q...</option>
              <option value="taproot">Taproot (P2TR) - bc1p...</option>
            </select>
          </div>
          <div id="relativePathContainer">
            <label for="relativePathInput">Relative Path</label>
            <input type="text" id="relativePathInput" value="0/0" placeholder="e.g., 0/0 or 1/5" />
          </div>
        </div>

        <div id="taprootWarning">
          <i class="fa-solid fa-triangle-exclamation"></i>
          Taproot uses Schnorr signatures (BIP-340). Standard message signing verification is not supported for Taproot addresses.
        </div>

        <div id="derivationPathResult"></div>

        <div id="messageInputContainer">
          <label for="messageInput">Challenge Message</label>
          <div id="buttonHolder">
            <input type="text" id="messageInput" placeholder="Enter a message to sign" />
            <button id="copyButton" title="Copy message and derivation path">
              <i class="fa-regular fa-copy"></i>
            </button>
            <span id="copyNotification">Copied!</span>
            <button id="exportButton" title="Export as .txt file">
              <i class="fa-solid fa-file-export"></i>
            </button>
            <button id="seedsignerQrButton" title="Generate SeedSigner signing QR code">
              <i class="fa-solid fa-qrcode"></i>
            </button>
          </div>
          <p id="seedsignerInfo">
            <i class="fa-solid fa-circle-info"></i>
            Generate a QR code for <a href="https://seedsigner.com" target="_blank">SeedSigner</a> signing.
            Multisig paths require <a href="https://github.com/AusDavo/seedsigner/releases/tag/0.8.6-multisig-msg-signing" target="_blank">patched firmware</a>.
            <a href="https://blog.dpinkerton.com/posts/patching-seedsigner-multisig-message-signing/" target="_blank">Learn more</a>.
          </p>
        </div>

        <div id="signatureInputContainer">
          <div id="signatureFormatContainer">
            <label for="signatureFormatSelect">Signature Format</label>
            <select id="signatureFormatSelect">
              <option value="electrum">Standard (Electrum)</option>
              <option value="bip137">BIP-137 (Trezor)</option>
              <option value="bip322">BIP-322 (Simple)</option>
            </select>
          </div>
          <label for="signatureInput">Signature</label>
          <div id="buttonHolder">
            <input type="text" id="signatureInput" placeholder="Paste the signature here" />
          </div>
          <button id="evaluateSignatureButton">
            <i class="fa-solid fa-check-double"></i>
            Verify Signature
          </button>
        </div>

        <div id="validationResult"></div>
      </section>

      <section id="importDescriptorContainer">
        <button id="importDescriptorButton">
          <i class="fa-solid fa-rotate"></i>
          Import a new descriptor
        </button>
      </section>
    </main>

    <footer>
      <p>
        <a href="https://github.com/AusDavo/gatekeeper" target="_blank" rel="noopener noreferrer">
          <i class="fa-brands fa-github"></i>
          View on GitHub
        </a>
      </p>
      <p>
        Built with
        <a href="https://github.com/bitcoinjs/bitcoinjs-lib" target="_blank" rel="noopener noreferrer">bitcoinjs-lib</a>
      </p>
      <p>
        Support development:
        <a href="lightning:gatekeeper@btcpay.dpinkerton.com" id="donationLink">
          <i class="fa-solid fa-bolt"></i>
          gatekeeper@btcpay.dpinkerton.com
        </a>
        <img
          src="./img/qr.png"
          alt="Lightning Address QR Code"
          id="qr-code-img"
        />
      </p>
    </footer>

    <div id="qrOverlay">
      <div id="qrModal">
        <img id="qrImage" alt="SeedSigner QR Code" />
        <p id="qrLabel"></p>
      </div>
    </div>

    <script defer src="bundled.js"></script>
  </body>
</html>
